import com.rameses.annotations.*;
import com.rameses.util.*;
import java.rmi.server.*;
import com.rameses.common.*;
import com.rameses.services.extended.*;

class WaterworksRateService extends ActiveListService
{
	@ActiveDB(value="waterworks_rate", em="waterworks")
	def em;

	@ActiveDB(value="waterworks_rate_item", em="waterworks")
	def item;

	@ProxyMethod
	def create(params){
		def result = em.create(params);
		if(result){
			result.rates.each{
				it.objid = 'RTI' + new UID().toString();
				it.parentid = result.objid;
				item.create(it);
			}
		}
		return result;
	}

	@ProxyMethod
	void update(params){
		delete(params);
		create(params);
	}

	@ProxyMethod
	void delete(params){
		if(params.rates){
			params.rates.each{
				item.delete(it);
			}
		}
		em.delete(params);
	}

	@ProxyMethod
	def getList(){
		def list = em.getList();
		list.each{
			it.rates = getRateItems(it);
		}
		return list;
	}

	@ProxyMethod
	def getRateItems(params){
		return em.getRateItems(params);
	}
}