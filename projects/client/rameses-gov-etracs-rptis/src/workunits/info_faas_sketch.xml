<?xml version="1.0" encoding="UTF-8"?>
<workunit>
    <invokers>
        <invoker type="faas:formActions" action="init" caption="Sketch" index="6" />
        <invoker type="faasmain:formActions" action="init" caption="Sketch" index="6" />
        <invoker type="sketch:open" action="init" caption="Sketch" index="6" />
        <invoker type="formActions" action="back" caption="Back"/>
   </invokers>
   <code>
<![CDATA[
        
import com.rameses.rcp.annotations.* 
import com.rameses.rcp.common.* 
import com.rameses.osiris2.client.*
import com.rameses.osiris2.common.*
import com.rameses.gov.etracs.rpt.util.*;

class SketchInfoController
{
    @Binding
    def binding;

    def svc;
    
    String title = 'Sketch'
    
    def entity;
    def image;
       
    void init(){
        image = DBImageUtil.getInstance().getImage(entity.objid);
    }
    
    def uploadSketch(){
        return InvokerUtil.lookupOpener('upload:image', [
            objid           : entity.objid,
            entity          : entity,
            autoClose       : true,
            showheader      : false,

            afterupload: {
                image = DBImageUtil.getInstance().getImage(entity.objid);
                binding.refresh('.*');
            }
        ]);
    }
    
    void removeSketch(){
        if ( MsgBox.confirm('Remove sketch?') ) {
            DBImageUtil.getInstance().deleteImage(entity.objid);
            image = null;
            binding.refresh('.*');
        }
    }
    
    void paste(){
        def header = [objid:entity.objid, refid:entity.objid, title:title];
        if ( DBImageUtil.getInstance().saveClipboardImage( header) > 0 ){
            image = DBImageUtil.getInstance().getImage(entity.objid);
            binding.refresh('.*');
        };
    }
    
    def back(){
        return "_close";
    }
    
}
 

]]>
   </code>
    
    <pages> 
        <page template="com.rameses.gov.etracs.rpt.util.SketchPage"/>
    </pages>
</workunit>


