<workunit>
    <invokers>
       <invoker type="cashreceipt:payoption" caption="Payment Option" target="popup" action="init"/>
    </invokers>
    <code>
        <![CDATA[
            import com.rameses.rcp.common.*
            import com.rameses.rcp.annotations.*
            import com.rameses.osiris2.client.*
            import com.rameses.osiris2.common.*
            import com.rameses.rulemgmt.constraint.*;
            import com.rameses.rulemgmt.*;
            import java.rmi.server.*;
            
            class PaymentOptionController  {
            
                @Binding
                def binding;
            
                String title = "Payment Option";
                def handler;
                def fullamount;
                
                def query = [:];
                def qtrs = (1..4);
                def payOptions;
                
                void init() {
                    payOptions =  ['FULLYEAR','FULLQTR','SPECIFY-AMOUNT'] ;
                }

                def doOk() {
                    def p = [:];
                    p.amount = query.amount;
                    p.qtr = query.qtr;
                    
                    if( query.option == 'SPECIFY-AMOUNT') {
                        if(query.amount > fullamount) {
                            p.option = 'OVERPAYMENT';
                            p.remarks = 'full';
                            p.paymode = 'full/overpayment';
                        }    
                        else if(query.amount < fullamount) {
                            p.option = 'PARTIAL';
                            p.remarks = 'partial';
                            p.paymode = 'partial';
                        }    
                        else {
                            p.option = 'FULLYEAR';
                            p.remarks = 'partial';
                            if( query.amount == fullamount ) p.remarks = 'full';
                            p.paymode = 'full';
                        }    
                    }
                    else if( p.option == 'FULLYEAR' ) {
                        p.option = query.option;
                        p.remarks = 'full';
                        p.paymode = 'full';
                    }
                    else {
                        p.option = query.option;
                        p.remarks = 'qtr ' + query.qtr;
                        p.paymode = 'qtr ' + query.qtr;
                    }
                    handler(p);
                    return "_close";
                }
                
                def doCancel() {
                    return "_close";
                }
                
                
            }
        ]]>    
    </code>
    
    <pages>
        <page template="com.rameses.gov.etracs.bpls.cashreceipt.PaymentOption"/>
    </pages>
    
</workunit>
