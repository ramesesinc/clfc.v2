<workunit>
    
   <invokers>
         <invoker type="make:create" caption="Make" action="create" target="popup" />
         <invoker type="make:open" caption="Make" action="open"  target="popup" />
   </invokers>
   
   <code>
       <![CDATA[
        import com.rameses.osiris2.common.*;
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        
        class MakeController extends CRUDController {
        
            String serviceName = "MakeService";
            String entityName = "make";
            String title = "Make";
            boolean allowApprove = false
            
            def modelHandler = [
                   fetchList: {
                        if( mode=='create') entity.models = []
                   
                        return entity.models
                   }, 
                   createItem: {
                        return [ 
                            objid: "MDL" + new java.rmi.server.UID()
                        ]
                   }, 
                   onAddItem: { o-> 
                        if( entity.models.find{it.code == o.code} ) throw new Exception("Model code already exists.    ")  
                        if(! o.unittype ) throw new Exception("Type is required.     ")  
                   }, 
                   onCommitItem: { o -> 
                        entity.models << o 
                   },
                   onRemoveItem: { o ->
                        if(! MsgBox.confirm('Remove item? ')) return false;
                     
                        entity.models.remove(o);
                        return true;
                    }
            ] as EditorListModel
        }      
        
       ]]>
   </code>
   
   <pages>
       <page template="com.rameses.gov.mtop.make.MakePage" />
   </pages>
   
</workunit>