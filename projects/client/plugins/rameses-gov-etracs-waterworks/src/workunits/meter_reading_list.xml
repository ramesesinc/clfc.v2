<workunit>
    <invokers>
        <invoker folderid="/home/waterworks" caption="Readings" action="init" index="5"/>
        <invoker type="formActions" caption="Close" action="_close"/>
        <invoker type="formActions" caption="Refresh" action="init"/>
    </invokers>
    
    <code>
        <![CDATA[
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*
        import java.rmi.server.UID;
        
        class MeterReadingController{
        
            @Service('WaterworksMeterReadingService')
            def readingSvc;
            
            @Service('DateService')
            def dateSvc;
        
            def data;
            def search;
            def title;
            
            void init(){
                data = readingSvc.getList([:]);
                search = [:];
                title = 'Meter Readings';
                if(readingModel != null) readingModel.reload();
            }
            
            def reading;
            def readingModel = [
                fetchList : {
                    return data;
                },
                fireSelectedItemChanged : {
                    reading = readingModel.getSelectedValue();
                    if(reading) loadMonthString(reading.month);
                }
            ] as BasicListModel;
            
            void loadMonthString(def m){
                def months = dateSvc.getMonths();
                months.each{
                    if(m == it.index) reading.monthstring = it.caption;
                }
            }

        }
        ]]>
    </code>
    
    <pages>
        <page template="com.rameses.gov.etracs.waterworks.reading.MeterReadingPage"/>
    </pages>
</workunit>