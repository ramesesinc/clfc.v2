<workunit>
    <invokers>
        <invoker type="waterrate:add" caption="Consumption Bracket" action="init" target="popup"/>
        <invoker type="waterrate:edit" caption="Consumption Bracket" action="open" target="popup"/>
    </invokers>
    
    <code>
        <![CDATA[
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*
        
        class AddRateController
        {
        
            def entity;
            def rates;
            def handler;
            def types;
            def mode;
            
            void init(){
                entity = [:];
                mode = "create";
                types = ["Fixed Amount","Rate Amount"];
            }
            
            void open(){
                mode = "edit";
                types = ["Fixed Amount","Rate Amount"];
            }
            
            def add(){
                if(entity.from > entity.to || entity.from == entity.to || entity.from < 0 || entity.to < 0) throw new Exception("Range is invalid!");
                boolean found = false;
                rates.each{
                    if(entity.from >= it.from && entity.from <= it.to) found = true;
                    if(entity.to >= it.from && entity.to <= it.to) found = true;
                }
                if(found) throw new Exception("Value is already defined!");
                handler(entity);
                return '_close';
            }
            
            def done(){
                handler(entity);
                return '_close';
            }

        }
        ]]>
    </code>
    
    <pages>
        <page template="com.rameses.gov.etracs.waterworks.rates.CreateRatePage"/>
    </pages>
</workunit>